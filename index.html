<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Ø±ÙˆØ²Ù†Ø§Ù…Ú†Ù‡ 3D Demo</title>
  <style>
    body, html {
      margin: 0; padding: 0; overflow: hidden;
      height: 100%; width: 100%;
      font-family: Tahoma, sans-serif;
      background: #000;
      color: white;
      text-align: center;
    }
    #overlay {
      position: absolute;
      top: 10px; left: 0; right: 0;
      z-index: 10;
      font-size: 20px;
      font-weight: bold;
    }
    #download-screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20;
      display: none;
    }
    #download-screen h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: #ffd700;
    }
    #download-screen p {
      font-size: 18px;
      margin-bottom: 30px;
    }
    .download-btn {
      padding: 16px 30px;
      background: #28a745;
      color: white;
      font-size: 20px;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      text-decoration: none;
    }
    #controls {
      position: absolute;
      bottom: 20px; left: 0; right: 0;
      display: flex; justify-content: center;
      gap: 20px;
      z-index: 15;
    }
    .ctrl-btn {
      width: 70px; height: 70px;
      border-radius: 50%;
      font-size: 28px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="overlay">Ø§Ù…ØªÛŒØ§Ø²: <span id="score">0</span></div>

  <div id="controls">
    <button class="ctrl-btn" id="left">â¬…ï¸</button>
    <button class="ctrl-btn" id="right">â¡ï¸</button>
  </div>

  <div id="download-screen">
    <h1>ğŸ‰ ØªØ¨Ø±ÛŒÚ©!</h1>
    <p>Ø´Ù…Ø§ Ø³ÙˆØ¯ Ø¬Ù…Ø¹ Ú©Ø±Ø¯ÛŒØ¯. Ø­Ø§Ù„Ø§ Ø¯Ø± Ø¯Ù†ÛŒØ§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ù‡Ù… Ø¨Ø±Ù†Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯.</p>
    <a href="https://mld10sar.github.io/Esmat/app-release.apk" class="download-btn" download>ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø±ÙˆØ²Ù†Ø§Ù…Ú†Ù‡</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script>
    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(0,10,5);
    scene.add(light);

    // Player
    const playerGeo = new THREE.BoxGeometry(1,1,1);
    const playerMat = new THREE.MeshStandardMaterial({color:0x007bff});
    const player = new THREE.Mesh(playerGeo, playerMat);
    player.position.set(0,0,5);
    scene.add(player);
    let lane = 0; // -1 left, 0 middle, 1 right

    // Floor
    const floorGeo = new THREE.PlaneGeometry(20,200);
    const floorMat = new THREE.MeshStandardMaterial({color:0x333333});
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI/2;
    floor.position.z = -90;
    scene.add(floor);

    // Obstacles & Coins
    let objects = [];
    let score = 0;
    let invincible = false;
    let startTime = Date.now();

    function spawnItem() {
      const type = Math.random()<0.7?"coin":"obstacle";
      const geo = new THREE.BoxGeometry(1,1,1);
      const mat = new THREE.MeshStandardMaterial({color: type==="coin"?0xffd700:0xff0000});
      const item = new THREE.Mesh(geo, mat);
      const laneChoice = [-2,0,2][Math.floor(Math.random()*3)];
      item.position.set(laneChoice,0,-100);
      item.userData = {type};
      scene.add(item);
      objects.push(item);
    }

    // Spawn every 1s
    setInterval(spawnItem,1000);

    // Controls
    document.getElementById("left").onclick=()=>{lane=Math.max(-1,lane-1);};
    document.getElementById("right").onclick=()=>{lane=Math.min(1,lane+1);};
    window.addEventListener("keydown",(e)=>{
      if(e.key==="ArrowLeft") lane=Math.max(-1,lane-1);
      if(e.key==="ArrowRight") lane=Math.min(1,lane+1);
    });

    // Game loop
    function animate(){
      requestAnimationFrame(animate);
      player.position.x = lane*2;

      objects.forEach((o)=>{
        o.position.z += 0.5; // move toward player
        if(o.position.distanceTo(player.position)<1){
          if(o.userData.type==="coin"){
            score+=10;
            document.getElementById("score").innerText=score;
            scene.remove(o);
          } else if(!invincible) {
            score=Math.max(0,score-20);
            document.getElementById("score").innerText=score;
            invincible=true;
            player.material.color.set(0x00ff00);
            setTimeout(()=>{
              invincible=false;
              player.material.color.set(0x007bff);
            },2000);
          }
        }
      });
      objects = objects.filter(o=>o.position.z<10);

      renderer.render(scene,camera);

      // End after 15s
      if(Date.now()-startTime>15000){
        document.getElementById("download-screen").style.display="flex";
      }
    }
    camera.position.set(0,5,10);
    camera.lookAt(0,0,0);
    animate();

    window.addEventListener("resize",()=>{
      camera.aspect=window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
