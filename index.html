<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cash Flow Runner 3D</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
    }
    #info {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-family: Arial, sans-serif;
      font-size: 20px;
      color: #fff;
      z-index: 1;
      text-align: center;
      padding: 6px 14px;
      background: rgba(0,0,0,0.5);
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div id="info">ðŸ’° Collect Profit Coins â€¢ Avoid Debt Blocks</div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.148.0/build/three.min.js"></script>

  <script>
    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Player (cube = shopkeeper)
    const geometry = new THREE.BoxGeometry(1.5, 1.5, 1.5);
    const material = new THREE.MeshStandardMaterial({ color: 0x0077ff });
    const player = new THREE.Mesh(geometry, material);
    scene.add(player);

    // Floor
    const floorGeo = new THREE.PlaneGeometry(20, 1000);
    const floorMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    // Lighting
    const ambient = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambient);
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(5, 10, 7);
    scene.add(dirLight);

    // Camera position
    camera.position.z = 5;
    camera.position.y = 3;
    camera.lookAt(0, 0, 0);

    // Obstacles and coins
    const obstacles = [];
    const coins = [];

    function spawnObstacle(zPos) {
      const geo = new THREE.BoxGeometry(2, 2, 2);
      const mat = new THREE.MeshStandardMaterial({ color: 0xff4444 });
      const obs = new THREE.Mesh(geo, mat);
      obs.position.set((Math.random() > 0.5 ? -3 : 3), 1, zPos);
      scene.add(obs);
      obstacles.push(obs);
    }

    function spawnCoin(zPos) {
      const geo = new THREE.SphereGeometry(0.7, 16, 16);
      const mat = new THREE.MeshStandardMaterial({ color: 0xffd700, emissive: 0x333300 });
      const coin = new THREE.Mesh(geo, mat);
      coin.position.set((Math.random() > 0.5 ? -3 : 3), 1, zPos);
      scene.add(coin);
      coins.push(coin);
    }

    for (let i = -20; i > -200; i -= 10) {
      if (Math.random() > 0.5) spawnObstacle(i);
      else spawnCoin(i);
    }

    // Movement
    let playerX = 0;
    const laneOffset = 3;

    function moveLeft() {
      playerX = -laneOffset;
    }
    function moveRight() {
      playerX = laneOffset;
    }
    function resetLane() {
      playerX = 0;
    }

    // Keyboard controls
    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") moveLeft();
      if (e.key === "ArrowRight") moveRight();
      if (e.key === "ArrowUp") resetLane();
    });

    // Touch controls
    let touchStartX = null;
    window.addEventListener("touchstart", (e) => {
      touchStartX = e.touches[0].clientX;
    });
    window.addEventListener("touchend", (e) => {
      if (touchStartX === null) return;
      const touchEndX = e.changedTouches[0].clientX;
      const diff = touchEndX - touchStartX;
      if (diff > 50) moveRight();
      else if (diff < -50) moveLeft();
      else resetLane();
      touchStartX = null;
    });

    // Score
    let score = 0;
    const info = document.getElementById("info");

    // Animate
    function animate() {
      requestAnimationFrame(animate);

      // Smooth player movement
      player.position.x += (playerX - player.position.x) * 0.2;

      // Move floor objects
      obstacles.forEach((obs) => {
        obs.position.z += 0.2;
        if (obs.position.z > 5) {
          obs.position.z = -200;
        }
        // Collision detection
        if (Math.abs(player.position.x - obs.position.x) < 1.5 &&
            Math.abs(player.position.z - obs.position.z) < 1.5) {
          info.textContent = "ðŸ’¥ Hit Debt Block! Game Over â€¢ Score: " + score;
          cancelAnimationFrame(animate);
        }
      });

      coins.forEach((coin) => {
        coin.position.z += 0.2;
        if (coin.position.z > 5) {
          coin.position.z = -200;
        }
        if (Math.abs(player.position.x - coin.position.x) < 1.5 &&
            Math.abs(player.position.z - coin.position.z) < 1.5) {
          score += 10;
          info.textContent = "ðŸ’° Score: " + score;
          coin.position.z = -200;
        }
      });

      renderer.render(scene, camera);
    }
    animate();

    // Resize handler
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
